   ID DIVISION.                            
   PROGRAM-ID. CASESTDY.                   
   ENVIRONMENT DIVISION.                   
   INPUT-OUTPUT SECTION.                   
   FILE-CONTROL.                           
        SELECT MASTERPT ASSIGN TO DD1      
        ORGANIZATION IS INDEXED            
        ACCESS MODE IS DYNAMIC             
        RECORD KEY IS PET-ID OF MASTER     
  *     ALTERNATE KEY IS PET-TYPE OF MASTER
        FILE STATUS IS WS-FS1.             
        SELECT SALETRX ASSIGN TO DD2       
        ORGANIZATION IS SEQUENTIAL         
        ACCESS MODE IS SEQUENTIAL          
        FILE STATUS IS WS-FS2.             
        SELECT PROCSALE ASSIGN TO AS-DD3   
        ORGANIZATION IS SEQUENTIAL         
        ACCESS MODE IS SEQUENTIAL          
        FILE STATUS IS WS-FS3.             
        SELECT PENDSALE ASSIGN TO DD4      
        ORGANIZATION IS SEQUENTIAL         
        ACCESS MODE IS SEQUENTIAL          
        FILE STATUS IS WS-FS4.             
     DATA DIVISION. 
      FILE SECTION.                                   
 FD MASTERPT.                                    
 01 MASTER.                                      
       05 PET-ID                  PIC XXX.       
       05 PET-TYPE                PIC X.         
          88 CAT      VALUE '1'.                 
          88 DOG      VALUE '2'.                 
          88 BIRD     VALUE '3'.                 
          88 FISH     VALUE '4'.                 
       05 BREED                   PIC X(10).     
       05 DOP                     PIC 9(6).      
       05 CP                      PIC 9999V99.   
       05 QUANT-AV                PIC 99.        
       05 FILLER                  PIC X(52).     
  FD SALETRX.                                    
  01 TRX.                                        
       05 PET-ID                  PIC XXX.       
       05 MRP                     PIC 9999V99.   
       05 QUANT-BOU               PIC 99.        
       05 FILLER                  PIC X(69).     
  FD PROCSALE.                                   
  01 PROCESS.                                    
       05 PET-ID                  PIC XXX.       
       05 DOP                     PIC 9(6).      
       05 QUANT-BOU               PIC 99.        
        05 TP                      PIC 99999V99. 
        05 PROF-LOSS               PIC S9999V99. 
        05 FILLER                  PIC X(56).    
   FD PENDSALE.                                  
   01 UNPROCESS.                                 
        05 PET-ID                  PIC XXX.      
        05 MRP                     PIC 9999V99.  
        05 QUANT-BOU               PIC 99.       
        05 FILLER                  PIC X(69).    
   WORKING-STORAGE SECTION.                      
   77 WS-FS1                     PIC 99.         
   77 WS-FS2                     PIC 99.         
   77 WS-FS3                     PIC 99.         
   77 WS-FS4                     PIC 99.         
   77 TEMP1                      PIC 99.         
   77 TEMP2                      PIC 9(7).       
   PROCEDURE DIVISION.                           
   OPEN-PARA.                                    
        OPEN I-O    MASTERPT                     
        OPEN INPUT  SALETRX                      
        OPEN EXTEND PROCSALE                     
         IF WS-FS3  NOT = 0                      
            OPEN OUTPUT PROCSALE                 
         END-IF                                  
        OPEN EXTEND PENDSALE                     
          IF WS-FS4  NOT = 0                                      
             OPEN OUTPUT PENDSALE                                 
          END-IF                                                  
         DISPLAY "OPEN STATUS" WS-FS1                             
         DISPLAY "OPEN STATUS" WS-FS2                             
         DISPLAY "OPEN STATUS" WS-FS3                             
         DISPLAY "OPEN STATUS" WS-FS4                             
         PERFORM TRXX-PARA UNTIL WS-FS2 NOT = 0                   
         CLOSE SALETRX                                            
         STOP RUN.                                                
    TRXX-PARA.                                                    
         READ SALETRX                                             
         AT END DISPLAY "ALL RECORDS ARE PROCESSED"               
         NOT AT END                                               
         PERFORM MASTER-RWRT-PARA                                 
         END-READ.                                                
    MASTER-RWRT-PARA.                                             
         MOVE PET-ID OF TRX TO PET-ID OF MASTER                   
         READ MASTERPT                                            
         KEY IS PET-ID OF MASTER                                  
         INVALID KEY DISPLAY "PET IS NOT AVAILABLE"               
         PERFORM PEND-PARA                                        
         NOT INVALID KEY                                          
         IF QUANT-AV OF MASTER >= QUANT-BOU OF TRX                
         COMPUTE TEMP1 = (QUANT-AV OF MASTER) - (QUANT-BOU OF TRX)
          MOVE TEMP1 TO QUANT-AV OF MASTER                     
          REWRITE MASTER                                       
          PERFORM PROCESS-PARA                                 
         ELSE                                                  
          PERFORM PEND-PARA                                    
          END-IF                                               
          END-READ.                                            
     PROCESS-PARA.                                             
          MOVE CORR MASTER TO PROCESS                          
          MOVE QUANT-BOU OF TRX TO QUANT-BOU OF PROCESS        
          COMPUTE TEMP2 = ( MRP OF TRX * QUANT-BOU OF TRX )    
          MOVE TEMP2 TO TP                                     
          COMPUTE PROF-LOSS = ( QUANT-BOU OF TRX * CP - TP )   
          WRITE PROCESS.                                       
     PEND-PARA.                                                
          MOVE CORR TRX TO UNPROCESS                           
          WRITE UNPROCESS.                                                            